<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Email Management + Reuse</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
body {
    font-family: sans-serif;
    background: #f0f2f5;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.container {
    width: 95%;
    max-width: 420px;
}

.card {
    background: white;
    padding: 18px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    margin-bottom: 22px;
}

h2, h3 {
    text-align: center;
    margin-top: 0;
}

textarea, input, button {
    font-size: 16px;
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

.btn {
    background: #007bff;
    color: white;
    border: none;
    cursor: pointer;
}

.btn:hover {
    background: #0056b3;
}

/* N√∫t xanh l√° */
.btn-green {
    background: #28a745 !important;
    color: white;
}

.btn-green:hover {
    background: #1c7c31 !important;
}

/* N√∫t copy email l·ªõn */
#copyButton {
    font-size: 22px;
    padding: 18px;
    margin-top: 25px;
    background: #28a745;
}

/* Email Reuse */
.row-two {
    display: flex;
    gap: 10px;
    margin-top: 12px;
}

#reuseButton, #reuseInput {
    background: #eee;
    padding: 12px;
    border-radius: 8px;
    flex: 1;
    text-align: left;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    box-sizing: border-box;
    border: 1px solid #ccc;
}

#reuseButton {
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#reuseButton span:first-child {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
    margin-right: 6px;
}

.count {
    flex-shrink: 0;
    font-size: 14px;
    opacity: 0.7;
}

.actions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

.actions button {
    flex: 1;
    font-size: 14px;
    padding: 12px;
    border-radius: 8px;
    border: none;
    background: #333;
    color: white;
}
</style>
</head>
<body>

<div class="container">

    <!-- ======================= QU·∫¢N L√ù EMAIL ONLINE ======================= -->
    <div class="card">
        <h3>üì® Qu·∫£n l√Ω Email Online</h3>

        <textarea id="emailListInput" placeholder="D√°n text ch·ª©a email ..."></textarea>
        <button id="addListButton" class="btn">‚ûï Th√™m Email</button>
        <button id="deleteListButton" class="btn" style="background:#dc3545;">üóë X√≥a to√†n b·ªô</button>

        <input type="text" id="emailOutput" placeholder="Email ƒë√£ copy s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y" readonly>

        <p id="count"></p>
        <p id="output" style="font-size:14px; opacity:0.9;"></p>

        <button id="copyButton" class="btn-green">üìã L·∫•y & Copy Email</button>
    </div>

    <!-- ======================= EMAIL REUSE ======================= -->
    <div class="card">
        <h3>Email Reuse</h3>

        <div class="row-two">
            <!-- Button hi·ªÉn th·ªã email, b·∫•m s·∫Ω ƒë·∫©y email v√†o Firebase -->
            <button id="reuseButton">
                <span id="reuseCurrent"></span>
                <span id="reuseCount" class="count"></span>
            </button>

            <!-- Input d√°n clipboard -->
            <input id="reuseInput" placeholder="D√°n email v√†o ƒë√¢y">
        </div>

        <div class="actions" style="display:flex; gap:8px;">
    <!-- C·ªôt d·ªçc 25%: D√°n clipboard + ƒê·ªïi email -->
    <div style="display:flex; flex-direction:column; flex:1; gap:8px;">
        <button id="addReuse">D√°n clipboard</button>
        <button id="nextReuse">ƒê·ªïi email</button>
    </div>

    <!-- N√∫t copy 50% -->
    <button id="copyReuse" class="btn-green" style="flex:2;">Copy</button>
</div>

    </div>

</div>


<script>
/* ===================== FIREBASE INIT ===================== */
const firebaseConfig = {
    apiKey: "AIzaSyBamvJrV2Eu0UZIHb5FHVXlb_FwTpmjtrs",
    authDomain: "mail24h-cd179.firebaseapp.com",
    databaseURL: "https://mail24h-cd179-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "mail24h-cd179",
    storageBucket: "mail24h-cd179.firebasestorage.app",
    messagingSenderId: "484024741448",
    appId: "1:484024741448:web:45192b44004f4b3bc4f27d"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();

/* ------------------ EMAIL REUSE ------------------ */
const reuseRef = db.ref("reuseEmails");

const reuseCurrentSpan = document.getElementById("reuseCurrent");
const reuseCountSpan = document.getElementById("reuseCount");
const reuseInput = document.getElementById("reuseInput");
const reuseButton = document.getElementById("reuseButton");
const addReuseBtn = document.getElementById("addReuse");

let reuseCache = [];
let reuseSet = new Set();

reuseRef.on("value", snap => {
    reuseCache = [];
    reuseSet.clear();
    snap.forEach(c => {
        reuseCache.push({ key: c.key, email: c.val() });
        reuseSet.add(c.val());
    });
    refreshReuseUI();
});

function refreshReuseUI() {
    if (reuseCache.length === 0) {
        reuseCurrentSpan.textContent = "";
        reuseCountSpan.textContent = "(0)";
    } else {
        reuseCurrentSpan.textContent = reuseCache[0].email;
        reuseCountSpan.textContent = `(${reuseCache.length})`;
    }
}

// N√∫t ‚ÄúD√°n clipboard‚Äù ch·ªâ d√°n v√†o input
addReuseBtn.onclick = async () => {
    try {
        const clipboardText = await navigator.clipboard.readText();
        reuseInput.value = clipboardText.trim();
    } catch (err) {
        console.error("Kh√¥ng th·ªÉ ƒë·ªçc clipboard:", err);
    }
};

// B·∫•m √¥ email hi·ªán t·∫°i s·∫Ω ƒë·∫©y email t·ª´ input v√†o Firebase
reuseButton.onclick = () => {
    const email = reuseInput.value.trim();
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (!email || !emailRegex.test(email)) return;

    if (reuseSet.has(email)) {
        reuseInput.value = "";
        return;
    }

    reuseRef.push(email);
    reuseInput.value = "";
};

// ƒê·ªïi email
document.getElementById("nextReuse").onclick = () => {
    if (reuseCache.length === 0) return;
    reuseRef.child(reuseCache[0].key).remove();
};

// Copy email ƒëang d√πng
document.getElementById("copyReuse").onclick = () => {
    if (reuseCache.length === 0) return;
    navigator.clipboard.writeText(reuseCache[0].email);
};

/* ------------------ QU·∫¢N L√ù EMAIL ONLINE ------------------ */
const emailRef = db.ref("emails");
let emailList = [];

const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

function extractEmails(text) {
    let parts = text.split(/[\s,;|]+/);
    let set = new Set();
    parts.forEach(t => {
        t = t.trim().toLowerCase();
        if (emailRegex.test(t)) set.add(t);
    });
    return [...set];
}

function updateCount() {
    document.getElementById("count").textContent = `üìä C√≤n l·∫°i: ${emailList.length}`;
}

emailRef.on("value", snap => {
    emailList = snap.val() || [];
    updateCount();
});

document.getElementById("addListButton").onclick = () => {
    const input = document.getElementById("emailListInput").value.trim();
    const list = extractEmails(input);
    if (list.length === 0) {
        output.textContent = "‚ö†Ô∏è Kh√¥ng c√≥ email h·ª£p l·ªá.";
        return;
    }
    emailRef.transaction(curr => {
        curr = curr || [];
        list.forEach(e => {
            if (!curr.includes(e)) curr.push(e);
        });
        return curr;
    });
    document.getElementById("emailListInput").value = "";
    output.textContent = `‚úÖ ƒê√£ th√™m ${list.length} email.`;
};

document.getElementById("deleteListButton").onclick = () => {
    if (!confirm("X√≥a to√†n b·ªô email?")) return;
    emailRef.set([]);
};

function copy(text) {
    navigator.clipboard.writeText(text);
    output.textContent = `‚úÖ Copied: ${text}`;
}

document.getElementById("copyButton").onclick = () => {
    if (emailList.length === 0) {
        output.textContent = "H·∫øt email!";
        return;
    }
    const idx = Math.floor(Math.random() * emailList.length);
    const email = emailList[idx];
    copy(email);
    document.getElementById("emailOutput").value = email;
    emailRef.transaction(curr => {
        if (!curr) return [];
        curr.splice(idx, 1);
        return curr;
    });
};
</script>

</body>
</html>
